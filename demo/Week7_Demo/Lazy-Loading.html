<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Lazy Loading Demo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }
      h1 {
        margin-bottom: 10px;
      }
      .card {
        background: white;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 20px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }
      .card img {
        width: 100%;
        max-width: 400px;
        display: block;
        border-radius: 6px;
      }
      .placeholder {
        background: #ddd;
        height: 250px;
        width: 100%;
        max-width: 400px;
        border-radius: 6px;
        display: block;
      }
      .info {
        font-size: 14px;
        color: #555;
      }
    </style>
  </head>
  <body>
    <h1>Lazy Loading Images Demo</h1>
    <p class="info">
      Scroll down slowly. Images are loaded <strong>only</strong> when they come
      into view. Open DevTools → Network → filter "Img" to see requests.
    </p>
    <!-- <img src="" alt="" loading="lazy"> -->

    <div id="cards-container"></div>

    <script>
      const container = document.getElementById("cards-container");

      // -----------------------------
      // Create demo cards with fake images
      // -----------------------------
      // We'll generate 10 cards with different image URLs.
      for (let i = 1; i <= 10; i++) {
        const card = document.createElement("div");
        card.className = "card";

        const title = document.createElement("h3");
        title.textContent = "Card " + i;

        // Placeholder div that will become <img> lazy loaded
        const img = document.createElement("img");

        // We set a tiny placeholder as initial src (or could be a local tiny image).
        img.src =
          "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="; // 1x1 transparent gif
        img.classList.add("lazy-image");

        // Store the REAL image URL in data-src
        // Using placeholder.com to avoid random failures
        img.dataset.src = `https://via.placeholder.com/400x250.png?text=Image+${i}`;

        const text = document.createElement("p");
        text.textContent =
          "This image will load only when you scroll to this card.";

        card.appendChild(title);
        card.appendChild(img);
        card.appendChild(text);

        container.appendChild(card);
      }

      // -----------------------------
      // Lazy loading logic using IntersectionObserver
      // -----------------------------
      const lazyImages = document.querySelectorAll("img.lazy-image");

      const observer = new IntersectionObserver(
        (entries, obs) => {
          entries.forEach((entry) => {
            // isIntersecting === true → element is in or near the viewport
            if (entry.isIntersecting) {
              const img = entry.target;
              // Swap the src with actual image URL
              img.src = img.dataset.src;
              console.log("Loading image:", img.dataset.src);

              // Remove the lazy class to avoid reprocessing
              img.classList.remove("lazy-image");

              // Stop observing this image – it’s already loaded
              obs.unobserve(img);
            }
          });
        },
        {
          rootMargin: "100px",
          threshold: 1, // call when at least 10% visible
        }
      );

      lazyImages.forEach((img) => observer.observe(img));
    </script>
  </body>
</html>
